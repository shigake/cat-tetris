import{r as l,g as y,u as F,d as B,j as e,m as M}from"./index-d5856a23.js";function R(){const[d,h]=l.useState(null),[o,u]=l.useState([]),[S,p]=l.useState(null),[N,n]=l.useState(null);l.useEffect(()=>{try{const s=y.resolve("multiplayerService");n(s.getStats())}catch{}},[]);const r=l.useCallback((s,m)=>{try{const i=y.resolve("multiplayerService"),c=i.startLocalMatch(s,m);return h(c.mode),u(c.players),p(i.getMatchState()),c}catch{return null}},[]),a=l.useCallback((s,m)=>{try{const i=y.resolve("multiplayerService"),c=i.startAIMatch(s,m);return h(c.mode),u(c.players),p(i.getMatchState()),c}catch{return null}},[]),f=l.useCallback((s,m)=>{try{const i=y.resolve("multiplayerService"),c=i.startAIvsAIMatch(s,m);return h(c.mode),u(c.players),p(i.getMatchState()),c}catch{return null}},[]),A=l.useCallback((s,m)=>{try{const i=y.resolve("multiplayerService");i.updatePlayerState(s,m);const c=i.getMatchState();return p(c),u(c.players),c}catch{return null}},[]),$=l.useCallback(()=>{try{const s=y.resolve("multiplayerService"),m=s.endMatch();return h(null),u([]),p(null),n(s.getStats()),m}catch{return null}},[]),k=l.useCallback(()=>{try{return y.resolve("multiplayerService").getAvailableModes()}catch{return[]}},[]),C=l.useCallback(()=>{try{const s=y.resolve("multiplayerService");n(s.getStats())}catch{}},[]);return{currentMode:d,players:o,matchState:S,stats:N,startLocalMatch:r,startAIMatch:a,startAIvsAIMatch:f,updatePlayerState:A,endMatch:$,getAvailableModes:k,refreshStats:C}}function z(){const[d,h]=l.useState("medium"),[o,u]=l.useState(null);l.useEffect(()=>{try{const n=y.resolve("aiOpponentService");n.setDifficulty(d),u(n)}catch{}},[d]);const S=l.useCallback(n=>{if(!o)return null;try{return o.decideNextMove(n)}catch{return null}},[o]),p=l.useCallback(n=>{h(n),o&&o.setDifficulty(n)},[o]),N=l.useCallback(()=>o?o.getDifficulties():[],[o]);return{difficulty:d,changeDifficulty:p,getNextMove:S,getDifficulties:N}}function O({onClose:d,onStartMatch:h}){const{getAvailableModes:o,stats:u,startLocalMatch:S,startAIMatch:p,startAIvsAIMatch:N}=R(),{getDifficulties:n}=z(),{t:r}=F(),[a,f]=l.useState(null),[A,$]=l.useState(r("multiplayer.player1"));l.useState(r("multiplayer.player2"));const[k,C]=l.useState("medium"),[s,m]=l.useState("expert"),[i,c]=l.useState("expert"),b=o(),g=n(),E=((b==null?void 0:b.length)||0)+1,{selectedIndex:P}=B({itemCount:E,columns:2,onConfirm:t=>{if(t<b.length){const x=b[t];x&&!x.disabled&&L(x)}else d()},onBack:d,active:!a,wrap:!0}),v=(g==null?void 0:g.length)||0,I=(a==null?void 0:a.id)==="ai-vs-ai"?v*2+2:v+2,{selectedIndex:w}=B({itemCount:I,columns:2,onConfirm:t=>{(a==null?void 0:a.id)==="vs-ai"?t<v?C(g[t].id):t===v?D():f(null):(a==null?void 0:a.id)==="ai-vs-ai"&&(t<v?m(g[t].id):t<v*2?c(g[t-v].id):t===v*2?D():f(null))},onBack:()=>f(null),active:!!a,wrap:!0});if(!b||b.length===0)return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-red-900/90 text-white p-6 rounded-lg",children:[e.jsx("p",{className:"text-xl",children:r("multiplayer.errorLoading")}),e.jsx("button",{onClick:d,className:"mt-4 bg-white text-black px-4 py-2 rounded",children:r("common.close")})]})});const L=t=>{t.disabled||f(t)},D=()=>{let t=null;a.id==="vs-ai"?t=p(A,k):a.id==="ai-vs-ai"&&(t=N(s,i)),t&&h&&h(t)},j="ring-2 ring-yellow-400 ring-offset-2 ring-offset-purple-900";return e.jsx(M.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:d,children:e.jsxs(M.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-gradient-to-br from-purple-900/95 to-indigo-900/95 rounded-2xl p-4 sm:p-5 max-w-2xl w-full border-2 border-white/20 shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:r("multiplayer.title")}),e.jsx("button",{onClick:d,className:"text-white/60 hover:text-white text-xl transition-colors",children:"‚úï"})]}),a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3 bg-black/30 rounded-lg p-3",children:[e.jsx("span",{className:"text-3xl",children:a.emoji}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:a.name}),e.jsx("p",{className:"text-white/60 text-xs",children:a.description})]})]}),a.id==="vs-ai"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block text-white/80 text-sm mb-1",children:r("multiplayer.aiDifficulty")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:g.map((t,x)=>e.jsx("button",{onClick:()=>C(t.id),className:`p-2.5 rounded-lg border-2 transition-all text-left ${k===t.id?"bg-blue-600 border-blue-400":"bg-black/30 border-white/20 hover:border-white/40"} ${w===x?j:""}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:t.emoji}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-bold text-sm",children:t.name}),e.jsx("div",{className:"text-white/60 text-[10px]",children:t.description})]})]})},t.id))})]}),a.id==="ai-vs-ai"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block text-white/80 text-sm mb-1",children:r("multiplayer.ai1Left")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-2",children:g.map((t,x)=>e.jsx("button",{onClick:()=>m(t.id),className:`p-2 rounded-lg border-2 transition-all text-left ${s===t.id?"bg-blue-600 border-blue-400":"bg-black/30 border-white/20 hover:border-white/40"} ${w===x?j:""}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:t.emoji}),e.jsx("div",{className:"text-white font-bold text-xs",children:t.name})]})},t.id))}),e.jsx("label",{className:"block text-white/80 text-sm mb-1",children:r("multiplayer.ai2Right")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-2",children:g.map((t,x)=>e.jsx("button",{onClick:()=>c(t.id),className:`p-2 rounded-lg border-2 transition-all text-left ${i===t.id?"bg-red-600 border-red-400":"bg-black/30 border-white/20 hover:border-white/40"} ${w===x+v?j:""}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:t.emoji}),e.jsx("div",{className:"text-white font-bold text-xs",children:t.name})]})},t.id))})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs(M.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:D,className:`flex-1 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-400 hover:to-emerald-500 text-white font-bold py-3 rounded-lg shadow-lg transition-all ${w===I-2?j:""}`,children:["üéÆ ",r("multiplayer.startMatch")]}),e.jsxs("button",{onClick:()=>f(null),className:`px-4 py-3 rounded-lg text-white/70 hover:text-white bg-white/10 hover:bg-white/20 transition-all font-bold ${w===I-1?j:""}`,children:["‚Üê ",r("multiplayer.back")]})]}),e.jsx("p",{className:"text-white/30 text-xs text-center mt-2",children:r("multiplayer.gamepadBack")})]}):e.jsxs(e.Fragment,{children:[u&&e.jsxs("div",{className:"flex gap-4 justify-center bg-black/30 rounded-lg px-3 py-2 mb-3 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"font-bold text-white",children:u.aiMatches}),e.jsx("span",{className:"text-white/50 ml-1",children:r("multiplayer.matchesVsAI")})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"font-bold text-green-400",children:u.wins}),e.jsx("span",{className:"text-white/50 ml-1",children:r("multiplayer.wins")})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("span",{className:"font-bold text-yellow-400",children:[u.winRate,"%"]}),e.jsx("span",{className:"text-white/50 ml-1",children:r("multiplayer.winRate")})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mb-3",children:b.map((t,x)=>e.jsxs(M.button,{whileHover:t.disabled?{}:{scale:1.02},whileTap:t.disabled?{}:{scale:.98},onClick:()=>L(t),disabled:t.disabled,className:`p-4 rounded-xl border-2 text-left transition-all ${t.disabled?"bg-gray-800/50 border-gray-700 opacity-50 cursor-not-allowed":"bg-gradient-to-br from-blue-600/30 to-purple-600/30 border-blue-500/50 hover:border-blue-400 cursor-pointer"} ${x===P?j:""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:t.emoji}),e.jsx("h3",{className:"text-base font-bold text-white",children:t.name})]}),e.jsx("p",{className:"text-white/70 text-xs",children:t.description}),t.disabled&&e.jsx("div",{className:"mt-1 text-yellow-400 text-xs font-bold",children:r("multiplayer.comingSoon")})]},t.id))}),e.jsxs("button",{onClick:d,className:`w-full py-2 rounded-lg text-white/70 hover:text-white bg-white/10 hover:bg-white/20 transition-all text-sm font-bold ${P===b.length?j:""}`,children:["‚Üê ",r("multiplayer.back")]}),e.jsx("p",{className:"text-white/30 text-xs text-center mt-2",children:r("multiplayer.gamepadBack")})]})]})})}export{O as default};
