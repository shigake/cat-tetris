import{u as B,r as n,l as T,a as A,s as D,b as P,c as _,d as H,j as e,A as O,m as w,K as F,k as U,M as z,e as I,B as L,G as Y,f as q,g as J}from"./index-d5856a23.js";const V=({isOpen:h,onClose:E,settings:c,onSettingsChange:G})=>{const{t:s}=B(),[a,o]=n.useState({...c,das:c.das??133,arr:c.arr??10}),[g,f]=n.useState(()=>T()),[l,p]=n.useState(null),d=n.useRef(null),[y,v]=n.useState(()=>A()),[x,j]=n.useState(null);n.useEffect(()=>{h&&(f(T()),v(A()))},[h]),n.useEffect(()=>{if(!l){d.current&&(clearInterval(d.current),d.current=null);return}const t=Date.now();d.current=setInterval(()=>{var u;if(Date.now()-t<200)return;const C=navigator.getGamepads(),i=Array.from(C).find(r=>r&&r.connected);if(i){for(let r=0;r<i.buttons.length;r++)if((u=i.buttons[r])!=null&&u.pressed){if(r>=12&&r<=15)continue;const S={...g,[l]:r};f(S),D(S),p(null);return}}},16);const m=setTimeout(()=>p(null),5e3);return()=>{clearInterval(d.current),d.current=null,clearTimeout(m)}},[l,g]);const K=n.useCallback(()=>{const t=P();f(t)},[]);n.useEffect(()=>{if(!x)return;const t=i=>{i.preventDefault(),i.stopPropagation();const u={...y,[x]:i.key};v(u),q(u),j(null)},m=setTimeout(()=>{window.addEventListener("keydown",t,{capture:!0})},100),C=setTimeout(()=>j(null),5e3);return()=>{clearTimeout(m),clearTimeout(C),window.removeEventListener("keydown",t,{capture:!0})}},[x,y]);const $=n.useCallback(()=>{const t=_();v(t)},[]),N=()=>{G(a);try{J.resolve("keyboardInputService").reloadMappings()}catch{}E()},b=()=>{o({...c,das:c.das??133,arr:c.arr??10}),E()},k=[N,b],R=n.useCallback(t=>{var m;(m=k[t])==null||m.call(k)},[N,b]),{selectedIndex:M}=H({itemCount:2,onConfirm:R,onBack:b,active:h&&!l,wrap:!0});return e.jsx(O,{children:h&&e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs(w.div,{initial:{scale:.9,y:10},animate:{scale:1,y:0},exit:{scale:.9,y:10},transition:{duration:.15,ease:"easeOut"},className:"bg-gray-900/90 p-6 rounded-2xl border-2 border-white/20 shadow-2xl max-w-md w-full mx-4 max-h-[85vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-cat font-bold text-white mb-5 text-center",children:s("settings.title")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-xs font-bold text-white/40 uppercase tracking-wider",children:s("settings.audio")}),e.jsxs("div",{children:[e.jsx("label",{className:"text-white/80 text-sm",children:s("settings.volume")}),e.jsx("input",{type:"range",min:"0",max:"100",value:a.volume,onChange:t=>o({...a,volume:parseInt(t.target.value)}),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"}),e.jsxs("span",{className:"text-white text-sm",children:[a.volume,"%"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"soundEnabled",checked:a.soundEnabled,onChange:t=>o({...a,soundEnabled:t.target.checked}),className:"mr-2"}),e.jsx("label",{htmlFor:"soundEnabled",className:"text-white/80 text-sm",children:s("settings.soundEnabled")})]}),e.jsxs("div",{className:"border-t border-white/10 pt-4 mt-4",children:[e.jsx("div",{className:"text-xs font-bold text-white/40 uppercase tracking-wider mb-3",children:s("settings.handling")}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"text-white/80 text-sm",children:s("settings.dasLabel")}),e.jsxs("span",{className:"text-cyan-400 text-sm font-mono",children:[a.das,"ms"]})]}),e.jsx("input",{type:"range",min:"0",max:"300",step:"1",value:a.das,onChange:t=>o({...a,das:parseInt(t.target.value)}),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),e.jsx("p",{className:"text-white/30 text-xs mt-0.5",children:s("settings.dasHelp")})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"text-white/80 text-sm",children:s("settings.arrLabel")}),e.jsxs("span",{className:"text-cyan-400 text-sm font-mono",children:[a.arr,"ms"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",step:"1",value:a.arr,onChange:t=>o({...a,arr:parseInt(t.target.value)}),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),e.jsx("p",{className:"text-white/30 text-xs mt-0.5",children:s("settings.arrHelp")})]})]}),e.jsxs("div",{className:"border-t border-white/10 pt-4 mt-4",children:[e.jsx("div",{className:"text-xs font-bold text-white/40 uppercase tracking-wider mb-3",children:s("settings.keyboardTitle")}),e.jsx("div",{className:"space-y-1",children:F.map(t=>e.jsxs("button",{onClick:()=>{j(t),p(null)},className:`w-full flex items-center justify-between bg-white/[0.04] rounded-lg px-3 py-1.5 text-xs transition-colors
                        ${x===t?"ring-2 ring-yellow-400 bg-yellow-400/10":"hover:bg-white/[0.08]"}`,children:[e.jsx("span",{className:"text-white/70",children:s(`settings.keyAction.${t}`)}),e.jsx("span",{className:`font-mono font-bold ${x===t?"text-yellow-400 animate-pulse":"text-cyan-400"}`,children:x===t?s("settings.keyPress"):U(y[t])})]},t))}),e.jsx("button",{onClick:$,className:"w-full mt-2 bg-white/[0.06] hover:bg-white/[0.12] text-white/60 hover:text-white/90 text-xs py-1.5 rounded-lg transition-colors",children:s("settings.keyReset")})]}),e.jsxs("div",{className:"border-t border-white/10 pt-4 mt-4",children:[e.jsx("div",{className:"text-xs font-bold text-white/40 uppercase tracking-wider mb-3",children:s("settings.gamepadButtons")}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-white/50 text-[10px] uppercase tracking-wider mb-1.5",children:s("settings.gamepadMenu")}),e.jsx("div",{className:"space-y-1",children:z.map(t=>e.jsxs("button",{onClick:()=>p(t),className:`w-full flex items-center justify-between bg-white/[0.04] rounded-lg px-3 py-1.5 text-xs transition-colors
                          ${l===t?"ring-2 ring-yellow-400 bg-yellow-400/10":"hover:bg-white/[0.08]"}`,children:[e.jsx("span",{className:"text-white/70",children:I[t]}),e.jsx("span",{className:`font-mono font-bold ${l===t?"text-yellow-400 animate-pulse":"text-cyan-400"}`,children:l===t?s("settings.gamepadPress"):L[g[t]]??"?"})]},t))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-white/50 text-[10px] uppercase tracking-wider mb-1.5",children:s("settings.gamepadGame")}),e.jsx("div",{className:"space-y-1",children:Y.map(t=>e.jsxs("button",{onClick:()=>p(t),className:`w-full flex items-center justify-between bg-white/[0.04] rounded-lg px-3 py-1.5 text-xs transition-colors
                          ${l===t?"ring-2 ring-yellow-400 bg-yellow-400/10":"hover:bg-white/[0.08]"}`,children:[e.jsx("span",{className:"text-white/70",children:I[t]}),e.jsx("span",{className:`font-mono font-bold ${l===t?"text-yellow-400 animate-pulse":"text-cyan-400"}`,children:l===t?s("settings.gamepadPress"):L[g[t]]??"?"})]},t))})]}),e.jsx("div",{className:"text-white/30 text-[10px] mb-2",children:s("settings.dpadNote")}),e.jsx("button",{onClick:K,className:"w-full bg-white/[0.06] hover:bg-white/[0.12] text-white/60 hover:text-white/90 text-xs py-1.5 rounded-lg transition-colors",children:s("settings.gamepadReset")})]}),e.jsxs("div",{className:"border-t border-white/10 pt-4 mt-4",children:[e.jsx("div",{className:"text-xs font-bold text-white/40 uppercase tracking-wider mb-3",children:s("settings.visual")}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"particlesEnabled",checked:a.particlesEnabled,onChange:t=>o({...a,particlesEnabled:t.target.checked}),className:"mr-2"}),e.jsx("label",{htmlFor:"particlesEnabled",className:"text-white/80 text-sm",children:s("settings.particles")})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(w.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:N,className:`flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 ${M===0?"ring-2 ring-yellow-400 ring-offset-2 ring-offset-gray-900":""}`,children:s("settings.save")}),e.jsx(w.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:b,className:`flex-1 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 ${M===1?"ring-2 ring-yellow-400 ring-offset-2 ring-offset-gray-900":""}`,children:s("settings.cancel")})]})]})})})};export{V as default};
