import{r as p,h as E,P as k,i as R,S as L,v as P,w as N,d as M,j as h,m as A,A as H,H as T,T as D,N as I,t as F}from"./index-21dd9244.js";class G{constructor(){this._actionQueue=[],this._lastPieceType=null,this._holdCooldown=0,this._comboCount=0,this.thinkingTime=0,this.lastDecision=0}setDifficulty(){}decideNextMove(t){var f;const i=Date.now();if(i-this.lastDecision<this.thinkingTime)return null;this.lastDecision=i;const{currentPiece:a,board:s,heldPiece:r,canHold:n}=t;if(!a||!s)return null;const c=a.type;if(c!==this._lastPieceType&&(this._lastPieceType=c,this._actionQueue=[],this._holdCooldown>0&&this._holdCooldown--),this._actionQueue.length>0)return this._actionQueue.shift();const e=s.length,d=((f=s[0])==null?void 0:f.length)||10,u=this._findBestMove(a,s,e,d);if(n&&this._holdCooldown<=0&&r){const x=this._findBestMove(r,s,e,d);if(x&&(!u||x.score>u.score+500))return this._holdCooldown=1,{action:"hold"}}return!u&&n&&this._holdCooldown<=0?(this._holdCooldown=1,{action:"hold"}):(u?this._actionQueue=this._buildActionSequence(a,u.rotations,u.targetX):this._actionQueue=[{action:"drop"}],this._actionQueue.shift()||{action:"drop"})}_findBestMove(t,i,a,s){let r=-1/0,n=null;for(let c=0;c<4;c++){const e=this._rotateShape(t.shape,c),d=e[0].length;for(let u=-1;u<=s-d+1;u++){const f=this._findLandingRow(e,i,u,a,s);if(f==null||f<0)continue;const x=this._placeOnBoard(e,i,u,f);if(!x)continue;const g=this._evaluate(x,i,f);g>r&&(r=g,n={rotations:c,targetX:u,score:g})}}return n}_evaluate(t,i,a){const s=t.length,r=t[0].length;let n=0;const c=this._countCompleteLines(t);c===1&&(n+=1e4),c===2&&(n+=25e3),c===3&&(n+=5e4),c>=4&&(n+=1e5);const e=this._removeCompleteLines(t);let d=0,u=0;for(let o=0;o<r;o++){let m=!1,l=0;for(let v=0;v<s;v++)e[v][o]!=null?(m=!0,l++):m&&(d++,u+=l)}n-=d*1e4,n-=u*1e3;const f=[];for(let o=0;o<r;o++){let m=0;for(let l=0;l<s;l++)if(e[l][o]!=null){m=s-l;break}f.push(m)}const x=Math.max(...f),g=f.reduce((o,m)=>o+m,0);n-=g*50,n-=x*100,x>12&&(n-=(x-12)*(x-12)*500),x>16&&(n-=1e5);let y=0;for(let o=0;o<r-1;o++)o===r-2?y+=Math.abs(f[o]-f[o+1])*.3:y+=Math.abs(f[o]-f[o+1]);n-=y*200;let _=0;for(let o=0;o<s;o++)if(e[o].filter(l=>l!=null).length!==0){for(let l=0;l<r-1;l++){const v=e[o][l]!=null,j=e[o][l+1]!=null;v!==j&&_++}e[o][0]==null&&_++,e[o][r-1]==null&&_++}n-=_*100;let C=0;for(let o=0;o<r;o++){for(let m=0;m<s-1;m++){const l=e[m][o]!=null,v=e[m+1][o]!=null;l!==v&&C++}e[s-1][o]==null&&C++}n-=C*80;const b=r-1;if(f[b]<f[b-1]){const o=f[b-1]-f[b];o>=1&&o<=4&&x<=12&&(n+=o*300)}for(let o=0;o<s;o++){const m=e[o].filter(l=>l!=null).length;m===9&&(n+=500),m===8&&(n+=200)}return n-=a>0?0:(s-a)*30,x>14&&(n+=c*5e4),n}_buildActionSequence(t,i,a){var d;const s=[],r=i%4;for(let u=0;u<r;u++)s.push({action:"rotate"});const n=((d=t.position)==null?void 0:d.x)??3,c=a-n,e=c>0?"right":"left";for(let u=0;u<Math.abs(c);u++)s.push({action:e});return s.push({action:"drop"}),s}_rotateShape(t,i){let a=t;for(let s=0;s<i%4;s++)a=a[0].map((r,n)=>a.map(c=>c[n]).reverse());return a}_findLandingRow(t,i,a,s,r){const n=t.length;for(let c=-n;c<s;c++)if(this._collides(t,i,a,c+1,s,r))return c;return s-n}_collides(t,i,a,s,r,n){for(let c=0;c<t.length;c++)for(let e=0;e<t[0].length;e++){if(!t[c][e])continue;const d=a+e,u=s+c;if(d<0||d>=n||u>=r||u>=0&&i[u][d]!=null)return!0}return!1}_placeOnBoard(t,i,a,s){const r=i.length,n=i[0].length,c=i.map(e=>[...e]);for(let e=0;e<t.length;e++)for(let d=0;d<t[0].length;d++){if(!t[e][d])continue;const u=a+d,f=s+e;if(u<0||u>=n||f<0||f>=r||c[f][u]!=null)return null;c[f][u]=1}return c}_removeCompleteLines(t){const i=t[0].length,a=t.filter(s=>!s.every(r=>r!=null));for(;a.length<t.length;)a.unshift(new Array(i).fill(null));return a}_countCompleteLines(t){return t.filter(i=>i.every(a=>a!=null)).length}_countHoles(t){let i=0;const a=t[0].length;for(let s=0;s<a;s++){let r=!1;for(let n=0;n<t.length;n++)t[n][s]!=null?r=!0:r&&i++}return i}_getMaxHeight(t){var s;const i=t.length,a=((s=t[0])==null?void 0:s.length)||10;for(let r=0;r<i;r++)for(let n=0;n<a;n++)if(t[r][n]!=null)return i-r;return 0}}const O=50;function B(w){const[t,i]=p.useState(null),[a,s]=p.useState({lines:0,combos:0,tetrises:0,maxCombo:0}),[r,n]=p.useState(!1),[c,e]=p.useState(!1),d=p.useRef(null),u=p.useRef(null),f=p.useRef(null),x=p.useRef(0),g=p.useRef(0),y=p.useRef({lines:0,combos:0,tetrises:0,maxCombo:0,currentCombo:0}),_=p.useCallback(()=>{const b=new E(new k,new R,null,new L);b.initializeGame(),b.isPlaying=!0;const o=new G;d.current=b,u.current=o,g.current=0,x.current=0,y.current.currentCombo=0,i(b.getGameState()),e(!0)},[]);p.useEffect(()=>{if(!w){f.current&&cancelAnimationFrame(f.current),d.current=null,u.current=null,e(!1),i(null),s({lines:0,combos:0,tetrises:0,maxCombo:0}),y.current={lines:0,combos:0,tetrises:0,maxCombo:0,currentCombo:0};return}_();const b=({linesCleared:m})=>{const l=y.current;l.lines+=m,l.currentCombo++,l.currentCombo>1&&(l.combos++,l.currentCombo>l.maxCombo&&(l.maxCombo=l.currentCombo),n(!0),setTimeout(()=>n(!1),600)),m>=4&&l.tetrises++,s({lines:l.lines,combos:l.combos,tetrises:l.tetrises,maxCombo:l.maxCombo})},o=({linesCleared:m})=>{m===0&&(y.current.currentCombo=0)};return P.on(N.LINE_CLEARED,b),P.on(N.PIECE_PLACED,o),()=>{f.current&&cancelAnimationFrame(f.current),P.off(N.LINE_CLEARED,b),P.off(N.PIECE_PLACED,o),d.current=null,u.current=null}},[w,_]),p.useEffect(()=>{if(!c||!d.current||!w)return;const b=o=>{x.current||(x.current=o);let m=o-x.current;x.current=o,m>200&&(m=16);const l=d.current,v=u.current;if(!(!l||!v)){if(l.gameOver){_(),f.current=requestAnimationFrame(b);return}if(l.isPlaying&&!l.isPaused&&l.updateGame(m),g.current+=m,g.current>=O){g.current=0;try{const j=l.getGameState(),S=v.decideNextMove(j);if(S)switch(S.action){case"left":l.movePiece("left");break;case"right":l.movePiece("right");break;case"rotate":l.rotatePiece();break;case"rotateLeft":l.rotatePieceLeft();break;case"down":l.movePiece("down");break;case"drop":l.hardDrop();break;case"hold":l.holdPiece();break}i(l.getGameState())}catch{}}f.current=requestAnimationFrame(b)}};return f.current=requestAnimationFrame(b),()=>{f.current&&cancelAnimationFrame(f.current)}},[c,w,_]);const C=p.useCallback(()=>{var b;try{return((b=d.current)==null?void 0:b.getDropPreview())||null}catch{return null}},[]);return{gameState:t,stats:a,comboFlash:r,isRunning:c,getDropPreview:C}}function q({onClose:w}){const{gameState:t,stats:i,comboFlash:a,getDropPreview:s}=B(!0),r=p.useCallback(()=>w(),[w]),{selectedIndex:n}=M({itemCount:1,onConfirm:r,onBack:r,active:!0}),c=p.useMemo(()=>s(),[t,s]);if(!t)return h.jsx("div",{className:"h-screen bg-gradient-to-b from-slate-950 via-violet-950 to-slate-950 flex items-center justify-center overflow-hidden",children:h.jsx("p",{className:"text-white/50 animate-pulse",children:"Preparando IA Expert..."})});const e=t.score;return h.jsxs("div",{className:"h-screen bg-gradient-to-b from-slate-950 via-violet-950 to-slate-950 flex flex-col overflow-hidden select-none",children:[h.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:h.jsx("div",{className:"absolute top-1/3 left-1/2 -translate-x-1/2 w-[500px] h-[500px] bg-cyan-600/10 rounded-full blur-[120px]"})}),h.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 bg-black/30 backdrop-blur-sm border-b border-white/10 shrink-0 relative z-10",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(A.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:w,className:`bg-white/15 hover:bg-white/25 text-white p-1.5 rounded-lg transition-colors ${n===0?"ring-2 ring-yellow-400":""}`,children:h.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:h.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})})}),h.jsx("span",{className:"text-sm font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-400",children:"ðŸ¤– Cat Tetris AI"})]}),h.jsxs("div",{className:`flex items-center gap-3 text-xs px-3 py-1 rounded-full transition-colors duration-300 ${a?"bg-cyan-500/30 text-cyan-300":"text-white/60"}`,children:[h.jsxs("span",{className:"font-bold",children:[i.lines," linhas"]}),h.jsxs("span",{children:["T:",i.tetrises]}),h.jsxs("span",{children:["C:",i.combos]}),h.jsxs("span",{children:["Max:",i.maxCombo]})]}),h.jsxs("div",{className:"text-xs text-white/50",children:[h.jsx("span",{className:"text-yellow-400 font-bold",children:((e==null?void 0:e.points)||0).toLocaleString()}),h.jsxs("span",{className:"ml-2",children:["Nv.",(e==null?void 0:e.level)||1]})]})]}),h.jsx(H,{children:a&&h.jsx(A.div,{initial:{opacity:0,scale:.7,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:1.2,y:-20},transition:{duration:.4,ease:"easeOut"},className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 pointer-events-none",children:h.jsx("div",{className:"text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-blue-400 to-yellow-300 drop-shadow-[0_0_30px_rgba(34,211,238,0.7)]",children:"COMBO!"})})}),h.jsx("div",{className:"flex-1 flex items-center justify-center overflow-hidden p-2 relative z-10",children:h.jsxs("div",{className:"flex gap-2 justify-center items-start",children:[h.jsx(T,{heldPiece:t.heldPiece,canHold:t.canHold}),h.jsx(D,{board:t.board,currentPiece:t.currentPiece,dropPreview:c,gameOver:t.gameOver}),h.jsxs("div",{className:"flex flex-col gap-2",children:[h.jsx(I,{pieces:t.nextPieces||[]}),h.jsx(F,{score:(e==null?void 0:e.points)||0,level:(e==null?void 0:e.level)||1,lines:(e==null?void 0:e.lines)||0,combo:(e==null?void 0:e.combo)||0})]})]})})]})}export{q as default};
