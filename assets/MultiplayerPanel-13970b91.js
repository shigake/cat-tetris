import{r as a,g,u as E,d as V,j as e,m as C}from"./index-21dd9244.js";function F(){const[d,h]=a.useState(null),[o,m]=a.useState([]),[S,p]=a.useState(null),[N,n]=a.useState(null);a.useEffect(()=>{try{const i=g.resolve("multiplayerService");n(i.getStats())}catch{}},[]);const l=a.useCallback((i,u)=>{try{const r=g.resolve("multiplayerService"),c=r.startLocalMatch(i,u);return h(c.mode),m(c.players),p(r.getMatchState()),c}catch{return null}},[]),s=a.useCallback((i,u)=>{try{const r=g.resolve("multiplayerService"),c=r.startAIMatch(i,u);return h(c.mode),m(c.players),p(r.getMatchState()),c}catch{return null}},[]),f=a.useCallback((i,u)=>{try{const r=g.resolve("multiplayerService"),c=r.startAIvsAIMatch(i,u);return h(c.mode),m(c.players),p(r.getMatchState()),c}catch{return null}},[]),M=a.useCallback((i,u)=>{try{const r=g.resolve("multiplayerService");r.updatePlayerState(i,u);const c=r.getMatchState();return p(c),m(c.players),c}catch{return null}},[]),D=a.useCallback(()=>{try{const i=g.resolve("multiplayerService"),u=i.endMatch();return h(null),m([]),p(null),n(i.getStats()),u}catch{return null}},[]),k=a.useCallback(()=>{try{return g.resolve("multiplayerService").getAvailableModes()}catch{return[]}},[]),A=a.useCallback(()=>{try{const i=g.resolve("multiplayerService");n(i.getStats())}catch{}},[]);return{currentMode:d,players:o,matchState:S,stats:N,startLocalMatch:l,startAIMatch:s,startAIvsAIMatch:f,updatePlayerState:M,endMatch:D,getAvailableModes:k,refreshStats:A}}function R(){const[d,h]=a.useState("medium"),[o,m]=a.useState(null);a.useEffect(()=>{try{const n=g.resolve("aiOpponentService");n.setDifficulty(d),m(n)}catch{}},[d]);const S=a.useCallback(n=>{if(!o)return null;try{return o.decideNextMove(n)}catch{return null}},[o]),p=a.useCallback(n=>{h(n),o&&o.setDifficulty(n)},[o]),N=a.useCallback(()=>o?o.getDifficulties():[],[o]);return{difficulty:d,changeDifficulty:p,getNextMove:S,getDifficulties:N}}function H({onClose:d,onStartMatch:h}){const{getAvailableModes:o,stats:m,startLocalMatch:S,startAIMatch:p,startAIvsAIMatch:N}=F(),{getDifficulties:n}=R(),{t:l}=E(),[s,f]=a.useState(null),[M,D]=a.useState(l("multiplayer.player1"));a.useState(l("multiplayer.player2"));const[k,A]=a.useState("medium"),[i,u]=a.useState("expert"),[r,c]=a.useState("expert"),b=o(),v=n(),B=((b==null?void 0:b.length)||0)+1,{selectedIndex:P}=V({itemCount:B,columns:2,onConfirm:t=>{if(t<b.length){const x=b[t];x&&!x.disabled&&L(x)}else d()},onBack:d,active:!s,wrap:!0}),y=(v==null?void 0:v.length)||0,I=(s==null?void 0:s.id)==="ai-vs-ai"?y*2+2:y+2,{selectedIndex:w}=V({itemCount:I,columns:2,onConfirm:t=>{(s==null?void 0:s.id)==="vs-ai"?t<y?A(v[t].id):t===y?$():f(null):(s==null?void 0:s.id)==="ai-vs-ai"&&(t<y?u(v[t].id):t<y*2?c(v[t-y].id):t===y*2?$():f(null))},onBack:()=>f(null),active:!!s,wrap:!0});if(!b||b.length===0)return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-red-900/90 text-white p-6 rounded-lg",children:[e.jsx("p",{className:"text-xl",children:l("multiplayer.errorLoading")}),e.jsx("button",{onClick:d,className:"mt-4 bg-white text-black px-4 py-2 rounded",children:l("common.close")})]})});const L=t=>{t.disabled||f(t)},$=()=>{let t=null;s.id==="vs-ai"?t=p(M,k):s.id==="ai-vs-ai"&&(t=N(i,r)),t&&h&&h(t)},j="ring-2 ring-yellow-400 ring-offset-2 ring-offset-purple-900";return e.jsx(C.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:d,children:e.jsxs(C.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-gradient-to-br from-purple-900/95 to-indigo-900/95 rounded-2xl p-4 sm:p-5 max-w-2xl w-full border-2 border-white/20 shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:l("multiplayer.title")}),e.jsx("button",{onClick:d,className:"text-white/60 hover:text-white text-xl transition-colors",children:"‚úï"})]}),s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3 bg-black/30 rounded-lg p-3",children:[e.jsx("span",{className:"text-3xl",children:s.emoji}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:s.id==="vs-ai"?l("multiplayer.mode.vsAi.name"):s.id==="ai-vs-ai"?l("multiplayer.mode.aiVsAi.name"):s.name}),e.jsx("p",{className:"text-white/60 text-xs",children:s.id==="vs-ai"?l("multiplayer.mode.vsAi.desc"):s.id==="ai-vs-ai"?l("multiplayer.mode.aiVsAi.desc"):s.description})]})]}),s.id==="vs-ai"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block text-white/80 text-sm mb-1",children:l("multiplayer.aiDifficulty")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:v.map((t,x)=>e.jsx("button",{onClick:()=>A(t.id),className:`p-2.5 rounded-lg border-2 transition-all text-left ${k===t.id?"bg-blue-600 border-blue-400":"bg-black/30 border-white/20 hover:border-white/40"} ${w===x?j:""}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:t.emoji}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-bold text-sm",children:l(`multiplayer.diff.${t.id}`)}),e.jsx("div",{className:"text-white/60 text-[10px]",children:l(`multiplayer.diff.${t.id}Desc`)})]})]})},t.id))})]}),s.id==="ai-vs-ai"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block text-white/80 text-sm mb-1",children:l("multiplayer.ai1Left")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-2",children:v.map((t,x)=>e.jsx("button",{onClick:()=>u(t.id),className:`p-2 rounded-lg border-2 transition-all text-left ${i===t.id?"bg-blue-600 border-blue-400":"bg-black/30 border-white/20 hover:border-white/40"} ${w===x?j:""}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:t.emoji}),e.jsx("div",{className:"text-white font-bold text-xs",children:l(`multiplayer.diff.${t.id}`)})]})},t.id))}),e.jsx("label",{className:"block text-white/80 text-sm mb-1",children:l("multiplayer.ai2Right")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-2",children:v.map((t,x)=>e.jsx("button",{onClick:()=>c(t.id),className:`p-2 rounded-lg border-2 transition-all text-left ${r===t.id?"bg-red-600 border-red-400":"bg-black/30 border-white/20 hover:border-white/40"} ${w===x+y?j:""}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:t.emoji}),e.jsx("div",{className:"text-white font-bold text-xs",children:l(`multiplayer.diff.${t.id}`)})]})},t.id))})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs(C.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:$,className:`flex-1 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-400 hover:to-emerald-500 text-white font-bold py-3 rounded-lg shadow-lg transition-all ${w===I-2?j:""}`,children:["üéÆ ",l("multiplayer.startMatch")]}),e.jsxs("button",{onClick:()=>f(null),className:`px-4 py-3 rounded-lg text-white/70 hover:text-white bg-white/10 hover:bg-white/20 transition-all font-bold ${w===I-1?j:""}`,children:["‚Üê ",l("multiplayer.back")]})]}),e.jsx("p",{className:"text-white/30 text-xs text-center mt-2",children:l("multiplayer.gamepadBack")})]}):e.jsxs(e.Fragment,{children:[m&&e.jsxs("div",{className:"flex gap-4 justify-center bg-black/30 rounded-lg px-3 py-2 mb-3 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"font-bold text-white",children:m.aiMatches}),e.jsx("span",{className:"text-white/50 ml-1",children:l("multiplayer.matchesVsAI")})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"font-bold text-green-400",children:m.wins}),e.jsx("span",{className:"text-white/50 ml-1",children:l("multiplayer.wins")})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("span",{className:"font-bold text-yellow-400",children:[m.winRate,"%"]}),e.jsx("span",{className:"text-white/50 ml-1",children:l("multiplayer.winRate")})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mb-3",children:b.map((t,x)=>e.jsxs(C.button,{whileHover:t.disabled?{}:{scale:1.02},whileTap:t.disabled?{}:{scale:.98},onClick:()=>L(t),disabled:t.disabled,className:`p-4 rounded-xl border-2 text-left transition-all ${t.disabled?"bg-gray-800/50 border-gray-700 opacity-50 cursor-not-allowed":"bg-gradient-to-br from-blue-600/30 to-purple-600/30 border-blue-500/50 hover:border-blue-400 cursor-pointer"} ${x===P?j:""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:t.emoji}),e.jsx("h3",{className:"text-base font-bold text-white",children:t.id==="vs-ai"?l("multiplayer.mode.vsAi.name"):t.id==="ai-vs-ai"?l("multiplayer.mode.aiVsAi.name"):t.name})]}),e.jsx("p",{className:"text-white/70 text-xs",children:t.id==="vs-ai"?l("multiplayer.mode.vsAi.desc"):t.id==="ai-vs-ai"?l("multiplayer.mode.aiVsAi.desc"):t.description}),t.disabled&&e.jsx("div",{className:"mt-1 text-yellow-400 text-xs font-bold",children:l("multiplayer.comingSoon")})]},t.id))}),e.jsxs("button",{onClick:d,className:`w-full py-2 rounded-lg text-white/70 hover:text-white bg-white/10 hover:bg-white/20 transition-all text-sm font-bold ${P===b.length?j:""}`,children:["‚Üê ",l("multiplayer.back")]}),e.jsx("p",{className:"text-white/30 text-xs text-center mt-2",children:l("multiplayer.gamepadBack")})]})]})})}export{H as default};
